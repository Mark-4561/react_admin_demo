{"ast":null,"code":"import \"antd/es/card/style/css\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/table/style/css\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style/css\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style/css\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/modal/style/css\";\nimport _Modal from \"antd/es/modal\";\nvar _jsxFileName = \"D:\\\\Mark\\\\RA\\\\ws\\\\react-admin\\\\src\\\\pages\\\\user\\\\user.jsx\";\nimport React, { Component } from \"react\";\nimport { withRouter } from 'react-router-dom';\nimport LinkButton from '../../components/link-button';\nimport { reqUsers, reqAddOrUpdateUser, reqDeleteUser } from '../../api';\nimport UserForm from './user-form';\nimport { PAGE_SIZE } from \"../../utils/constants\";\nimport { formateDate } from \"../../utils/dateUtils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass User extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      users: [],\n      user: {},\n      showStatus: 0\n    };\n\n    this.initColumns = () => {\n      this.columns = [{\n        title: '用户名',\n        dataIndex: 'username',\n        key: 'username'\n      }, {\n        title: '电话',\n        dataIndex: 'phone'\n      }, {\n        title: '邮箱',\n        dataIndex: 'email'\n      }, {\n        title: '注册时间',\n        dataIndex: 'create_time',\n        render: formateDate\n      }, {\n        title: '操作',\n        dataIndex: '',\n        width: 200,\n        render: user => /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [/*#__PURE__*/_jsxDEV(LinkButton, {\n            onClick: () => this.showUpdate(user),\n            children: \"\\u4FEE\\u6539\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 51,\n            columnNumber: 25\n          }, this), \" \", /*#__PURE__*/_jsxDEV(LinkButton, {\n            onClick: () => this.deleteUser(user),\n            children: \"\\u5220\\u9664\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 55,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 50,\n          columnNumber: 21\n        }, this)\n      }];\n    };\n\n    this.getUsers = async () => {\n      const result = await reqUsers();\n\n      if (result.status === 0) {\n        const {\n          users\n        } = result.data;\n        this.setState({\n          users\n        });\n      }\n    };\n\n    this.deleteUser = user => {\n      _Modal.confirm({\n        title: '确认删除' + user.username + '吗?',\n        onOk: async () => {\n          const result = await reqDeleteUser(user._id);\n\n          if (result.status === 0) {\n            _message.success('删除用户成功!');\n\n            this.getUsers();\n          } else {\n            _message.error('删除用户失败!');\n          }\n        }\n      });\n    };\n\n    this.addOrUpdateuser = async () => {\n      let user = this.us.current.addOrUpdateUser();\n      user.create_time = Date.now();\n\n      if (this.state.user._id) {\n        user._id = this.state.user._id;\n      }\n\n      const result = await reqAddOrUpdateUser(user);\n\n      if (result.status === 0) {\n        _message.success(`${this.state.user._id ? '修改' : '添加'}角色成功`);\n\n        this.getUsers();\n        this.setState({\n          showStatus: 0\n        });\n      } else {\n        _message.error(`${this.state.user._id ? '修改' : '添加'}角色失败`);\n      }\n    };\n\n    this.showUpdate = user => {\n      this.setState({\n        showStatus: 1,\n        user: user\n      });\n    };\n\n    this.handleCancel = () => {\n      this.setState({\n        showStatus: 0\n      });\n    };\n\n    this.us = /*#__PURE__*/React.createRef();\n  }\n\n  UNSAFE_componentWillMount() {\n    this.initColumns();\n  }\n\n  componentDidMount() {\n    this.getUsers();\n  }\n\n  render() {\n    const {\n      users,\n      showStatus\n    } = this.state;\n\n    const title = /*#__PURE__*/_jsxDEV(_Button, {\n      type: \"primary\",\n      onClick: () => {\n        this.setState({\n          showStatus: 1,\n          user: {}\n        });\n      },\n      children: \"\\u6DFB\\u52A0\\u7528\\u6237\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 13\n    }, this);\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(_Card, {\n        title: title,\n        children: [/*#__PURE__*/_jsxDEV(_Table, {\n          rowKey: \"_id\",\n          pagination: {\n            pageSize: PAGE_SIZE\n          },\n          dataSource: users,\n          columns: this.columns,\n          bordered: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n          title: this.state.user._id ? \"修改用户\" : \"添加用户\",\n          visible: showStatus === 1,\n          onOk: this.addOrUpdateuser,\n          onCancel: this.handleCancel,\n          destroyOnClose: true,\n          children: /*#__PURE__*/_jsxDEV(UserForm, {\n            ref: this.us,\n            user: this.state.user\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default _c = withRouter(User);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["D:/Mark/RA/ws/react-admin/src/pages/user/user.jsx"],"names":["React","Component","withRouter","LinkButton","reqUsers","reqAddOrUpdateUser","reqDeleteUser","UserForm","PAGE_SIZE","formateDate","User","constructor","props","state","users","user","showStatus","initColumns","columns","title","dataIndex","key","render","width","showUpdate","deleteUser","getUsers","result","status","data","setState","confirm","username","onOk","_id","success","error","addOrUpdateuser","us","current","addOrUpdateUser","create_time","Date","now","handleCancel","createRef","UNSAFE_componentWillMount","componentDidMount","pageSize"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\"\r\nimport { withRouter } from 'react-router-dom';\r\nimport { Card, Table, Button, message, Modal } from 'antd'\r\n\r\nimport LinkButton from '../../components/link-button';\r\nimport { reqUsers, reqAddOrUpdateUser, reqDeleteUser } from '../../api';\r\nimport UserForm from './user-form';\r\nimport { PAGE_SIZE } from \"../../utils/constants\";\r\nimport { formateDate } from \"../../utils/dateUtils\";\r\n\r\nclass User extends Component{\r\n\r\n    state = {\r\n        users: [], \r\n        user: {},\r\n        showStatus: 0,\r\n    };\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.us = React.createRef();\r\n    };\r\n\r\n    initColumns = () => {\r\n        this.columns = [\r\n            {\r\n                title: '用户名',\r\n                dataIndex: 'username',\r\n                key: 'username'\r\n            },\r\n            {\r\n                title: '电话',\r\n                dataIndex: 'phone'\r\n            },\r\n            {\r\n                title: '邮箱',\r\n                dataIndex: 'email'\r\n            },\r\n            {\r\n                title: '注册时间',\r\n                dataIndex: 'create_time',\r\n                render: formateDate\r\n            },\r\n            {\r\n                title: '操作',\r\n                dataIndex: '',\r\n                width: 200,\r\n\r\n                render: (user) => (\r\n                    <span>\r\n                        <LinkButton onClick={() => this.showUpdate(user)}>\r\n                            修改\r\n                        </LinkButton>\r\n                        {\" \"}\r\n                        <LinkButton onClick={() => this.deleteUser(user)}>\r\n                            删除\r\n                        </LinkButton>\r\n                    </span>\r\n                )\r\n            },\r\n\r\n        ]\r\n    };\r\n\r\n    getUsers = async () => {\r\n        const result = await reqUsers()\r\n        if (result.status === 0){\r\n            const { users } = result.data;\r\n            this.setState({ users });\r\n        }\r\n    };\r\n\r\n    deleteUser = (user) => {\r\n        Modal.confirm({\r\n            title: '确认删除'+ user.username +'吗?',\r\n      \r\n            onOk: async () => {\r\n                const result = await reqDeleteUser(user._id);\r\n                if (result.status === 0) {\r\n                    message.success('删除用户成功!');\r\n                    this.getUsers();\r\n                } \r\n                else {\r\n                    message.error('删除用户失败!');\r\n                }\r\n            },\r\n        });\r\n    };\r\n\r\n    addOrUpdateuser = async () => {\r\n        let user = this.us.current.addOrUpdateUser();\r\n        user.create_time = Date.now();\r\n        if (this.state.user._id) {\r\n            user._id = this.state.user._id;\r\n        }\r\n    \r\n        const result = await reqAddOrUpdateUser(user);\r\n        if (result.status === 0) {\r\n            message.success(`${this.state.user._id?'修改':'添加'}角色成功`);\r\n            this.getUsers();\r\n            this.setState({ showStatus: 0 });\r\n        } \r\n        else {\r\n            message.error(`${this.state.user._id?'修改':'添加'}角色失败`);\r\n        }\r\n    };\r\n\r\n    showUpdate = (user) => {\r\n        this.setState({ showStatus: 1,user:user });\r\n    };\r\n      \r\n    UNSAFE_componentWillMount() {\r\n        this.initColumns();\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.getUsers();\r\n    }\r\n\r\n    handleCancel = () => {\r\n        this.setState({ showStatus: 0 });\r\n    };\r\n\r\n    render(){\r\n        const { users, showStatus } = this.state;\r\n\r\n        const title = (\r\n            <Button\r\n                type='primary'\r\n                onClick={() => {\r\n                    this.setState({ showStatus: 1, user: {} });\r\n                }}\r\n            >\r\n                添加用户\r\n            </Button>\r\n        );\r\n\r\n        return(\r\n            <div>\r\n                <Card title={title}>\r\n                    <Table\r\n                        rowKey=\"_id\"\r\n                        pagination={{\r\n                            pageSize: PAGE_SIZE,\r\n                        }}\r\n                        dataSource={users}\r\n                        columns={this.columns}\r\n                        bordered\r\n                    />\r\n                    <Modal\r\n                        title={this.state.user._id ? \"修改用户\" : \"添加用户\"}\r\n                        visible={showStatus === 1}\r\n                        onOk={this.addOrUpdateuser}\r\n                        onCancel={this.handleCancel}\r\n                        destroyOnClose={true}\r\n                    >\r\n                        <UserForm ref={this.us} user={this.state.user} />\r\n                    </Modal>\r\n                </Card>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default withRouter(User);"]},"metadata":{},"sourceType":"module"}